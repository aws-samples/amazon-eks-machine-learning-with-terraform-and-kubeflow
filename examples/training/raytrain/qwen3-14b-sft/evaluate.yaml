framework: ray_train
ray:
  version: '2.52.1'
  dashboard:
    host: '0.0.0.0'
  ports:
    - name: gcs-server
      port: 6379
    - name: client
      port: 10001
    - name: dashboard
      port: 8265
  resources:
    requests:
      cpu: 300m 
    limits:
      cpu: 2
  runtime_env_yaml:
    runtimeEnvYAML: |
      pip:
        - transformers==4.57.1 
        - peft==0.18.0 
        - torchao==0.14.1 
        - vllm==0.12.0
        - "pandas==2.3.0"
        - "pyarrow==21.0.0"
        - bert-score==0.3.13 
        - evaluate==0.4.6
image:
image_pull_policy: Always
ebs:
  storage: 200Gi
  mount_path: /tmp
resources:
  requests:
    "nvidia.com/gpu": 8
  limits:
    "nvidia.com/gpu": 8 
  nnodes: 1 
  node_type: 'g6e.48xlarge' 
tolerations:
  - key: "nvidia.com/gpu"
    operator: "Exists"
    effect: "NoSchedule"
pre_script:
    - mkdir -p $HOME/logs/$HOSTNAME
    - PROCESS_LOG=$HOME/logs/$HOSTNAME/test_checkpoint.log
    - cd $SCRIPTS_DIR
train:
  env:
    - name: HOME
      value: "/efs/home/{{ .Release.Name }}"
    - name: MODEL_PATH
      value: "/fsx/pretrained-models/Qwen/Qwen3-14B"
    - name: NCCL_SOCKET_IFNAME 
      value: "^lo,docker0"
    - name: NCCL_DEBUG
      value: "WARN"
    - name: FI_EFA_USE_DEVICE_RDMA
      value: "1"
    - name: FI_PROVIDER
      value: "efa"
    - name: FI_EFA_FORK_SAFE
      value: "1"
    - name: RDMAV_FORK_SAFE
      value: "1"
    - name: TRITON_CACHE_DIR
      value: /tmp
    - name: XDG_CACHE_HOME
      value: /tmp
    - name: SCRIPTS_DIR
      value: /etc/framework-scripts
  command:
    - python
  args:
    - test_checkpoint.py
    - --base_model="Qwen/Qwen3-14B"
    - --model_path=$MODEL_PATH
    - --max_samples=1024
    - --batch_size=128
    - '2>&1 | tee $PROCESS_LOG' 
